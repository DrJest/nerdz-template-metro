$(document).ready(function() {
    var loading = N.getLangData().LOADING;
    
    $("body").append($('<br />')); 
    $("iframe").attr("scrolling","no");
    _h = $("head");
    if(!localStorage.getItem("metro-color")) 
      localStorage.setItem("metro-color","default");
    $color = "#4390DF";
    $colors = {"default":"#4390DF","lime":"#a4c400","amber":"#F0A30A", "red":"#e51400", "steel":"#555555"};
    var mc = localStorage.getItem("metro-color");
    if (mc!="default")
    {
      $color = $colors[mc];
      var rgb = $("<span>").css("background-color",$color).css("background-color").replace(/[^0-9,]/g,"").split(",");
      var hsl = rgb2hsl(rgb[0],rgb[1],rgb[2]);
      $lighter = ["hsl("+hsl[0], hsl[1]*100+"%", Math.floor(hsl[2]*130)+"%)"].join(",");
      var html = ('.news .nerdz_date, .news .post_icons, a, .spoiler > span, .question, #profilePostArrow, #projectPostArrow {'+
                  '  color: %color%;'+
                  '}'+
                  '.active {'+
                  '  color: %color% !important; '+
                  '}'+
                  '.news, .img_frame, .yt_frame, .window, .caption  {'+
                  '  border-color: %color% !important;'+
                  '}'+
                  '.img_frame:after, .yt_frame:after {'+
                  '  border-top: 28px solid %color%;'+
                  '}'+
                  '.window > .caption {'+
                  '  background-color: %color%;'+
                  '}'+
                  '.sidebar li a:hover {'+
                  '  background-color: %lighter% !important;'+
                  '}'+
                  '.more'+
                  '{'+
                  '  box-shadow: 0px -10px 10px 0px %color%;'+
                  '}'+
                  '.link:hover, a:hover {'+
                  ' color: %lighter%;'+
                  '}').replace(/\%color\%/g,$color).replace(/\%lighter\%/g, $lighter);
      $('<style type="text/css">').html(html).appendTo(_h);
      $("body").addClass( mc );
    }
    for(col in $colors)
      $("<div>").attr("class","tile tiny").html('<div class="tile-content icon"><i class="icon-record" style="color:'+$colors[col]+';"></i></div>')
                .attr("title",col).addClass( mc==col?"selected":"" ).appendTo($("#color-switcher"));

    ts = $("#theme-switcher");               
    if (localStorage.getItem("metro-theme"))
    {
      if(localStorage.getItem("metro-theme")=="light")
      {
        $(".sidebar").addClass("light")
        $(".navigation-bar").removeClass("dark").addClass("light")
      }
      ts.children("#"+localStorage.getItem("metro-theme")).addClass("selected");
      $("body").addClass(localStorage.getItem("metro-theme"))
    }
    else 
      ts.children("#dark").addClass("selected");

    $("#pref-metro").on("click", function(event) {
      event.stopPropagation();
    });
    
    $("#code-theme-switcher").on("change", function(e) {
      if( !$("#code-theme-switcher").is(':checked') ) 
        localStorage.removeItem("code-light-theme") 
      else 
        localStorage.setItem("code-light-theme", "1");
  
      setTimeout(function(){location.reload();},1000);
    });
    var append_theme = "";
    if (undefined == localStorage.getItem("code-light-theme"))
    {
      append_theme = "?skin=sons-of-obsidian";
      $("body").addClass("has-dark-theme");
    }
    else $("#code-theme-switcher").attr("checked",true);
    $("<script>").attr("type","text/javascript").attr("src",'https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.js'+append_theme).appendTo(_h)
    
    ts.on("click", ".tile", function(){
      if($(this).hasClass("selected")) return false;
      localStorage.setItem("metro-theme",$(this).attr("id"));
      setTimeout(function(){location.reload();},1000);
    })
    
    $("#color-switcher").on("click",".tile", function() {
      if($(this).hasClass("selected")) return false;
      localStorage.setItem("metro-color",$(this).attr("title"));
      setTimeout(function(){location.reload();},1000);
    });
    
    tp = $("#metro-tagpanel");
    if(localStorage.getItem("no-tagpanel")) 
      tp.attr("checked",false);
    tp.on("change", function(e) {
      if( tp.is(':checked') ) 
        localStorage.removeItem("no-tagpanel") 
      else {
        localStorage.setItem("no-tagpanel", "1");
      }
      TPUpdate();
    });
    tc = $("#tagpanel-custom");
    tc.on("click",function(event) {
      if(!$(".tagpanel").length) return false;
      event.stopPropagation();
      $.Dialog({
        shadow: true,
        overlay: false,
        icon: '<span class="icon-tools"></span>',
        title: 'Metro Tagpanel Options',
        width: 500,
        draggable: true,
        padding: 10,
        onShow: function(_dialog) {
          _dialog.css("width","450px");
            var tp = $(".tagpanel"),
          ch = tp.children("a");
          var html = '<label class="input-control switch">TagPanel: &nbsp;&nbsp;<input type="checkbox" id="w-metro-tagpanel" checked /><span class="check"></span></label><br /><br /><div id="checkbox">'
          ch = $(".tagpanel").children("a");
          $l = localStorage.getItem("tagpanel-custom");
          var label = function(name, index, checked) {
            return '<label style="width: 200px" data-i="'+index+'" class="input-control switch">'+name+': &nbsp;&nbsp;<input type="checkbox" '+(checked?"checked":"")+' /><span class="check"></span></label>&nbsp;&nbsp;';
          }
          
          html += label("Image Upload", 18, $l.charAt(18)=="0"?false:true )+"<br />";
          for (i=0;i<ch.length;++i)
            html += label( ch.eq(i).html(), i, $l.charAt(i)=="0"?false:true );
            
          html += '</div>';

          _dialog.children(".content").html(html);
                    
          _dialog.on("change","#w-metro-tagpanel", function() {
            $("#metro-tagpanel").click();
            cb = $("#checkbox").find("input[type=checkbox]");
            dis=!$(this).is(":checked"); 
            $.each(cb, function() {$(this).attr("disabled",dis)});
          }).on("change","#checkbox label", function() {
            i = $(this).data("i");
            $l = localStorage.getItem("tagpanel-custom");
            b = (+$(this).children("input").eq(0).is(":checked"));
            $n = $l.replaceAt(i, b)
            localStorage.setItem("tagpanel-custom",$n);
            TPUpdate();
          })
        }
      });
    });
    
    ns = $("#metro-notify");
    if(localStorage.getItem("metro-no-notify")) 
      ns.attr("checked",false);
    ns.on("change", function(e) {
      ( ns.is(':checked') ) ? localStorage.removeItem("metro-no-notify") : localStorage.setItem("metro-no-notify", "1");
    });
    $("#metro-info").on('click', function(event){
      event.stopPropagation();
      $.Dialog({
        shadow: true,
        overlay: false,
        icon: '<span class="icon-rocket"></span>',
        title: 'Nerdz Metro Template',
        width: 500,
        padding: 10,
        onShow: function(_dialog) {
          _dialog.css("min-height","150px");
          $.ajax({url:"/tpl/2/VERSION"}).done(function(d){
            _dialog.children(".content").html("<a href='https://github.com/nerdzeu/nerdz.eu/commit/{1}' target='_blank'> Nerdz, Last Commit {1} </a> <br />NerdzMetro Theme by Dr.Jest. Version {0} <br /> Barely based on work made by<a href='https://github.com/olton/Metro-UI-CSS/blob/master/LICENSE' target='_blank'> Sergey Pimenov </a>".format(d, Nversion));
          })
        }
      });
    });

    $("#notifycounter").on('click',function(e) {
      e.preventDefault();
      var list = $("#notify_list"), old = $(this).html();
      var nold = parseInt(old);
      list.toggle(200); 
      list.html(loading);
      N.html.getNotifications(function(d) {
        $("#pr_lo").remove();
        list.html(d);
      });
      $(this).html(isNaN(nold) ? old : '0');
    });

    if($.inArray(location.pathname,[ '/bbcode.php','/terms.php','/faq.php','/stats.php','/rank.php','/preferences.php', '/informations.php', '/preview.php' ]) != -1) {
           $("#footersearch").remove();
       };
    
    $("body").on("focus", "textarea", function(e) {
      $(this).height(0).height( this.scrollHeight );
    }).on("keyup", "textarea", function(e) {
      $("body").scrollTop = this.scrollTop ;
      $(this).height(0).height( this.scrollHeight );
      $(this).css("overflow", ( this.scrollHeight > parseInt($(this).css("max-height")) ) ? "auto" : "hidden" );
    }).on("keydown", "textarea", function(e) {
      if( e.ctrlKey && (e.keyCode == 10 || e.keyCode == 13) ) {
        $(this).parent().trigger('submit');
      }
    })
    
    $("#footersearch").on('submit',function(e) {
        e.preventDefault();
        var plist = $("#postlist");
        var qs =  $.trim($("#footersearch input[name=q]").val());
        var num = 10; 
        if(qs == '') {
            return false;
        }
        var manageResponse = function(d)
        {
            plist.html(d);
            sessionStorage.setItem('searchLoad', "1"); 
        };
        if(plist.data('type') == 'project')
        {
            if(plist.data('location') == 'home')
            {
                N.html.search.globalProjectPosts(num, qs, manageResponse);
            }
            else
            {
                if(plist.data('location') == 'project')
                {
                    N.html.search.specificProjectPosts(num, qs, plist.data('projectid'),manageResponse);
                }
            }
        }
        else
        {
            if(plist.data('location') == 'home')
            {
                N.html.search.globalProfilePosts(num, qs, manageResponse);
            }
            else
            {
                if(plist.data('location') == 'profile')
                {
                    N.html.search.specificProfilePosts(num, qs, plist.data('profileid'),manageResponse);
                }
            }
        }
        plist.data('mode','search');
    });

    $("#logout").on('click',function(event) {
        event.preventDefault();
        var t = $("#welcome");
        N.json.logout( { tok: $(this).data('tok') }, function(r) {
            var tmp = t.html();
            if(r.status == 'ok')
            {
                t.html(r.message);
                setTimeout(function() {
                    document.location.href = "/";
                    },1500);
            }
            else
            {
                t.html('<h2>'+ r.message + '</h2>');
                setTimeout(function() {
                    t.html(tmp);
                },1500);
            }
        });
    });

    $("#gotopm").on('click',function(e) {
            e.preventDefault();

            var href = $(this).attr('href');

            if($('#pmcounter').html() != '0') {

                if(href == window.location.pathname ) {
                    location.hash = "new";
                    location.reload();
                }
                else {
                    location.href='/pm.php#new';
                }
            }
            else
            {
                location.href = href;
            }
    });

    $(".preview").on('click',function(){
        var txt = $($(this).data('refto')).val().tag();
        if(undefined==localStorage.getItem("no-autolink")) txt = txt.autoLink();
        if(undefined != txt && txt != '') {
            window.open('/preview.php?message='+encodeURIComponent(txt));
        }
    });

    var plist = $("#postlist");

    plist.on('click', ".spoiler", function(e) {
        $(this).toggleClass("expanded");
    });

    plist.on('click','.preview',function(){
        var txtarea = $($(this).data('refto'));
        txtarea.val(txtarea.val()+' '); //workaround
        var txt = txtarea.val().tag();
        if(undefined==localStorage.getItem("no-autolink")) txt = txt.autoLink();
        txtarea.val($.trim(txtarea.val()));
        if(undefined != txt && $.trim(txt) != '') {
            window.open('/preview.php?message='+encodeURIComponent(txt));
        }
    });

    plist.on('click',".delcomment",function() {
        var refto = $('#' + $(this).data('refto'));
        sc = refto.parents("div[id^=\"post\"]").eq(0).find(".icon-comments-4");
        sc.html(parseInt(sc.html())-1);
        refto.html(loading+'...');
          N.json[plist.data('type')].delComment({ hcid: $(this).data('hcid') },function(d) {
            if(d.status == 'ok')
            {
                refto.remove();
            }
            else
            {
                refto.html(d.message);
            }
        });
    });

    plist.on('submit','.frmcomment',function(e) {
        e.preventDefault();
        var last, hcid, t,
            form     = $(this),
            hpid     = $(this).data ('hpid'),
            refto    = $('#commentlist' + hpid),
            error    = $(this).find ('.error').eq (0),
            clist    = refto.children(".comments").eq(0),
            comments = clist.children();
        if(comments.length)
        {
          last = comments.length > 1 ? comments.eq (comments.length - 2) : null;
          hcid = last ? last.data('hcid') : 0;
        }
        error.html (loading);
        var message = $(this).find('textarea').eq(0).val().tag();
        if(undefined==localStorage.getItem("no-autolink")) message = message.autoLink();
        N.json[plist.data('type')].addComment ({ hpid: hpid, message: message }, function(d) {
            if(d.status == 'ok')
            {
              if(hcid && last)
              {
                  N.html[plist.data('type')].getCommentsAfterHcid ({ hpid: hpid, hcid: hcid }, function(d) {
                    t = $("<div>").html(d);
                    var cmnum = t.children(".commentcount").eq(0).remove().html(),
                        newComments = t.children(".comments").eq(0).children(),
                        lastComment = comments.last();
                    lastComment.remove()
                    var internalLengthPointer = comments.length-1;
                    var n = internalLengthPointer + newComments.length,
                        mc = form.parent().find ('.more_btn').data('morecount'),
                        toshow = (mc?mc:0 + 1) * 10;
                    if(n>toshow) 
                    {
                      comments.slice(0,n-toshow).remove();
                      refto.children(".comment_btns").eq(0).show();
                    }
                    if(cmnum>20) refto.find(".all_comments_btn").parent().eq(0).show();
                    clist.append(newComments);
                    form.find('textarea').val ('');
                    error.html('');
                    $("#post"+hpid).find(".icon-comments-4").eq(0).text(cmnum);
                  });
              }
              else
              {
                  N.html[plist.data('type')].getComments( { hpid: hpid, start: 0, num: 10 },function(d) {
                      refto.html(d);
                      var cmnum = $("<div>").html(d).children(".commentcount").eq(0).remove().html();
                      $("#post"+hpid).find(".icon-comments-4").eq(0).text(cmnum);
                      error.html('');
                  });
              }
            }
            else
            {
                error.html(d.message);
            }
        });
    });
    
    plist.on('click', ".yt_frame", function(e) {
      e.preventDefault();
      var vid = $(this).data("vid");
      d = $.Dialog({
        overlay: false,
        shadow: true,
        sysButtons: {btnClose:true,btnMax:true,btnMin:true},
        icon: '<i class="icon-youtube"></i>',
        title: 'Youtube Video',
        draggable: true,
        height:520,
        width: 656,
        content: '',
        overlayClickClose: false,
        onClose: function() { $(document).unbind("keyup.yt"); },
        onShow: function(_dialog){
          $.Dialog.content('<iframe style="min-width:640px; min-height:480px; width: 100%; height:auto" src="//www.youtube.com/embed/'+vid+'" seamless></iframe>');
          w = _dialog;
          c = w.children(".content").eq(0);
          $(".btn-min").click(function(e) {
            e.preventDefault();
            if(!w.hasClass("minimized"))
            {
              w.addClass("minimized");
              if(w.hasClass("maximized")) w.removeClass("maximized").addClass("maximize")
            } else {
              w.hasClass("maximize") && w.addClass("maximized");
              w.removeClass("maximize").removeClass("minimized");
            }
          })
          $(".btn-max").click(function(e) {
            e.preventDefault();
            w.removeClass("minimized").removeClass("maximize");
            w.toggleClass("maximized");
            c.children().css("height",w.height()-30);
          });
          $(document).on("keyup.yt",function(e){
             var code = e.keyCode ? e.keyCode : e.which;
             if(code==27) $.Dialog.close(d);
          });
        }
      });
    });
    
    plist.on('click',".showcomments",function(e) {
        e.preventDefault();
        var hpid = $(this).data ('hpid'),
            refto = $('#' + $(this).data('refto')),
            count = $(this).children().eq(0);
        if(refto.html() == '')
        {
            refto.html(loading+'...').show();
            N.html[plist.data ('type')].getComments ({
                hpid: hpid,
                start: 0,
                num: 10
            }, function (res) {
                refto.hide().html(res).slideDown();
                count.html( refto.children(".commentcount").html() );
                if (document.location.hash == '#last')
                    refto.find ('.frmcomment textarea[name=message]').focus();
                else if (document.location.hash)
                    $(document).scrollTop ($(document.location.hash).offset().top);
            });
        }
        else
        {
            refto.slideUp(function(){refto.html('')});
        }
    });

    plist.on ('click', '.more_btn', function() {
        var moreBtn     = $(this),
            commentList = moreBtn.parents ("div[id^=\"commentlist\"]"),
            clist       = commentList.children(".comments").eq(0),
            hpid        = /^post(\d+)$/.exec (commentList.parents ("div[id^=\"post\"]").attr ("id"))[1],
            intCounter  = moreBtn.data ("morecount") || 0;
        if (moreBtn.data ("inprogress") === "1") return;
        moreBtn.data ("inprogress", "1").text (loading + "...");
        N.html[plist.data ('type')].getComments ({ hpid: hpid, start: intCounter + 1, num: 10 }, function (r) {
            moreBtn.data ("inprogress", "0").data ("morecount", ++intCounter).text (N.getLangData().MORE_COMMENTS);
            var _ref = $("<div>" + r + "</div>");
            clist.html(_ref.children(".comments").eq(0).html()+clist.html());
            if (intCounter == 1)
              commentList.find (".scroll_bottom_btn").parent().show();
            if ($.trim (r) == "" || _ref.find (".nerdz_from").length < 10 || (10 * (intCounter + 1)) == _ref.find (".commentcount:eq(0)").html())
            {
              commentList.find (".all_comments_btn").parent().hide();
              moreBtn.parent().hide();
            }
        });
    });

    plist.on ('click', '.scroll_bottom_btn', function() {
        var cList = $(this).parents().eq(2);
        $("html, body").animate ({ scrollTop: cList.find (".singlecomment:nth-last-child(2)").offset().top }, function() {
            cList.find (".frmcomment textarea").focus();
        });
    });

    plist.on ('click', '.all_comments_btn', function() {
        var btn         = $(this),
            commentList = btn.parents ("div[id^=\"commentlist\"]"),
            hpid        = /^post(\d+)$/.exec (commentList.parents ("div[id^=\"post\"]").attr ("id"))[1],
            moreBtn     = commentList.find (".more_btn");
        if (btn.data ("working") === "1" || moreBtn.data ("inprogress") === "1") return;
        btn.data ("working", "1").text (loading + "...");
        moreBtn.data ("inprogress", "1");
        N.html[plist.data ('type')].getComments ({ hpid: hpid, forceNoForm: true }, function (res) {
            btn.data ("working", "0").text(N.getLangData().EVERY_COMMENT).parent().hide();
            commentList.find (".scroll_bottom_btn").show();
            moreBtn.hide().data ("morecount", Math.ceil (parseInt ($("<div>").html(res).find (".commentcount").html()) / 10));
            commentList.children(".comments").eq(0).html(res);
        });
    });

    plist.on('click',".qu_ico",function() {
      var area = $("#"+$(this).data('refto'));
      area.insertAtCaret("[quote="+ $(this).data('hcid') +"|"+$(this).data('type')+"]");
      area.focus();
    });

    plist.on('click',".icon-remove",function(e) {
      e.preventDefault();
      var refto = $('#' + $(this).data('refto'));
      var post = refto.html();
      var hpid = $(this).data('hpid');

      N.json[plist.data('type')].delPostConfirm({ hpid: hpid },function(m) {
        if(m.status == 'ok') {
          refto.html('<div style="text-align:center">' + m.message + '<br /><span id="delPostOk' + hpid +'" style="cursor:pointer">'+N.getLangData().YES+'</span>|<span id="delPostNo'+hpid+'" style="cursor:pointer">'+N.getLangData().NO+'</span></div>');
          refto.on('click','#delPostOk'+hpid,function() {
            N.json[plist.data('type')].delPost({ hpid: hpid },function(j) {
             if(j.status == 'ok') {
              refto.remove();
              if(plist.data("singlepost")) location.href="/";
             }
             else {
              refto.html(j.message);
             }
            });
          });
          refto.on('click','#delPostNo'+hpid,function() {
            refto.html(post);
          });
       }
    });
  });

    plist.on('click',".icon-pencil",function(e) {
        e.preventDefault();
        var refto = $('#' + $(this).data('refto')), hpid = $(this).data('hpid');
        var form = function(fid, hpid, message) {
                    return  '<form style="margin-bottom:40px" id="' +fid+ '" data-hpid="'+hpid+'">' +
                            '<textarea id="'+fid+'abc" autofocus style="width:100%; height:125px">' +message+ '</textarea><br />' +
                            '<input type="submit" value="' + N.getLangData().EDIT +'" style="float: right; margin-top:5px; max-height: 26px !important" />' +
                            '<button type="button" style="float:right; margin-top: 5px; margin-right: 10px;" class="preview" data-refto="#'+fid+'abc">'+N.getLangData().PREVIEW+'</button>'+
                            '<button type="button" style="float:left; margin-top:5px; margin-right: 10px;" onclick="window.open(\'/bbcode.php\')">BBCode</button>' +
                            '<button type="button" style="float:left; margin-top:5px" class="cancel">'+N.getLangData().CANCEL+'</button>' +
                            '</form>';
                    };
            N.json[plist.data('type')].getPost({hpid: hpid},function(d) {
                 var fid = refto.attr('id') + 'editform';
                 refto.html(form(fid,hpid,d.message));

                 $('#'+fid).on('submit',function(e) {
                      e.preventDefault();
                      N.json[plist.data('type')].editPost(
                            {
                                 hpid: $(this).data('hpid'),
                                 message: $(this).children('textarea').val()
                            },function(d)
                            {
                                 if(d.status == 'ok')
                                 {
                                      refto.slideToggle("slow");
                                      N.html[plist.data('type')].getPost({hpid: hpid}, function(o) {
                                            refto.html(o);
                                            refto.slideToggle("slow");
                                            if(refto.data("hide")) {
                                              $(refto.find("div.small")[0]).prepend('<i title="'+refto.data("hide")+'" class="post_icons hide icon-cancel-2" data-postid="post'+hpid+'"></i>');
                                            }
                                      });
                                 }
                                 else {
                                      alert(d.message);
                                 }
                      });
                }).on("click",".cancel", function() {
                  refto.slideToggle("slow");
                  N.html[plist.data('type')].getPost({hpid: hpid}, function(o) {
                        refto.html(o);
                        refto.slideToggle("slow");
                        if(refto.data("hide")) {
                          $(refto.find("div.small")[0]).prepend('<i title="'+refto.data("hide")+'" class="post_icons hide icon-cancel-2" data-postid="post'+hpid+'"></i>');
                        }
                  });
                });
            });
    });

    plist.on('click',".icon-locked",function() {
        var me = $(this);
        var tog = function(d) {
            if(d.status == 'ok') {
                me.attr('class','post_icons icon-unlocked');
                me.attr('title',d.message);
            }
        }
          
          if($(this).data('silent')) {
              N.json[plist.data('type')].reNotifyFromUserInPost({ hpid: $(this).data('hpid'), from: $(this).data('silent') },function(d) {tog(d);});
          }
          else {
                 N.json[plist.data('type')].reNotifyForThisPost({hpid: $(this).data('hpid') },function(d) {tog(d);});
          }
    });

    plist.on('click',".icon-unlocked",function() {
        var me = $(this);
        var tog = function(d) {
            if(d.status == 'ok') {
                me.attr('class','post_icons icon-locked');
                me.attr('title',d.message);
            }
        }

        if($(this).data('silent')) {
            N.json[plist.data('type')].noNotifyFromUserInPost({ hpid: $(this).data('hpid'), from: $(this).data('silent') },function(d) {tog(d);});
        }
        else {
            N.json[plist.data('type')].noNotifyForThisPost({hpid: $(this).data('hpid') },function(d) {tog(d);});
        }
    });
    
    plist.on("click",".icon-eye-2", function() { //unlurk
      var me = $(this);
      var tog = function(d) {
          if(d.status == 'ok') {
              me.attr("class","post_icons icon-eye");
              me.attr('title',"Lurk");
          }
      }
      
      N.json[plist.data('type')].unlurkPost({hpid: $(this).data('hpid') },function(d) {tog(d);});
    })
    
    plist.on('click',".icon-eye",function() { //lurk
      var me = $(this);
      var tog = function(d) {
          if(d.status == 'ok') {
              me.attr("class","post_icons icon-eye-2");
              me.attr('title',"Unlurk");
          }
      }
      N.json[plist.data('type')].lurkPost({hpid: $(this).data('hpid') },function(d) {tog(d);});
    });

    plist.on('click',".icon-plus",function() {
        var me = $(this);
        var tog = function(d) {
            if(d.status == 'ok') {
                me.attr('class','post_icons icon-minus');
                me.attr('title',"Unbookmark");
            }
        }
          
          N.json[plist.data('type')].bookmarkPost({hpid: $(this).data('hpid') },function(d) {tog(d);});

    });

    plist.on('click',".icon-minus",function() {
        var me = $(this);
        var tog = function(d) {
            if(d.status == 'ok') {
                me.attr('class','post_icons icon-plus');
                me.attr('title',"Bookmark");
            }
        }
        N.json[plist.data('type')].unbookmarkPost({hpid: $(this).data('hpid') },function(d) {tog(d);});
    });

    $("body").on('click','.notref',function(e) {
        if (e.ctrlKey) return;
        e.preventDefault();
        var href = $(this).attr('href');
        if(href == window.location.pathname + window.location.hash) {
            location.reload();
        }
        else {
            location.href = href;
        }
    });
    
    TPLoad();

    var curnot = localStorage.getItem("curnot") ? parseInt(localStorage.getItem("curnot")) : 0;
    var curpm = localStorage.getItem("curpm") ? parseInt(localStorage.getItem("curpm")) : 0;
    setInterval(function() {
        var nc = $("#notifycounter"), val = parseInt(nc.html());
        nc.css('color',val == 0 || isNaN(val) ? $color : '#FF0000');
        if(!isNaN(val) && val != curnot && !localStorage.getItem("metro-no-notify"))
        {
          nw = val - curnot;
          if(nw>0)
          {
            N.html.getNotifications(function(d) {
              nn = $("<div>").html(d).children().length;
              nn==1?
                $.Notify.show(d, function(){N.html.getNotifications($.noop(),false)}) :
                $.Notify.show('<a href="#" onclick="">'+N.getLangData().NEW_NOTIFICATIONS.format(nn)+'</a>', function(){$('#notifycounter').click();});
              $("#notifyaudio")[0].play();
            },true);
          }
          curnot = val;
          localStorage.setItem("curnot",curnot);
        }
        var pc = $("#pmcounter");
        val = parseInt(pc.html());
        if(!isNaN(val) && val != curpm && !localStorage.getItem("metro-no-notify")) 
        {
          nw = val-curpm;
          if(nw>0)
          {
            $.Notify.show('<a style="cursor:pointer">'+(nw==1?N.getLangData().NEW_MESSAGE : N.getLangData().NEW_MESSAGES.format(nw) )+'!</a>', function() {$("#gotopm").click()});
            $("#notifyaudio")[0].play();
          }
          curpm = val;
          localStorage.setItem("curpm",val);
        }
        pc.css('color',val == 0 || isNaN(val) ? $color : '#FF0000');
    },200);
});

var _0x3ebb=["\x2C","\x73\x70\x6C\x69\x74","\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x34\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x34\x30\x39\x35\x32\x32\x33\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x66\x2F\x66\x63\x2F\x46\x41\x4E\x4D\x41\x44\x45\x5F\x41\x6C\x69\x63\x6F\x72\x6E\x5F\x4F\x63\x74\x61\x76\x69\x61\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x46\x41\x4E\x4D\x41\x44\x45\x5F\x41\x6C\x69\x63\x6F\x72\x6E\x5F\x4F\x63\x74\x61\x76\x69\x61\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x34\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x34\x30\x36\x31\x37\x31\x34\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x62\x2F\x62\x38\x2F\x45\x61\x67\x6C\x65\x5F\x73\x6E\x61\x74\x63\x68\x69\x6E\x67\x5F\x66\x69\x73\x68\x5F\x77\x69\x74\x68\x5F\x6D\x61\x70\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x45\x61\x67\x6C\x65\x5F\x73\x6E\x61\x74\x63\x68\x69\x6E\x67\x5F\x66\x69\x73\x68\x5F\x77\x69\x74\x68\x5F\x6D\x61\x70\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x31\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x34\x30\x34\x30\x31\x33\x30\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x32\x2F\x32\x35\x2F\x55\x70\x70\x65\x72\x5F\x43\x72\x75\x73\x74\x5F\x61\x73\x6B\x69\x6E\x67\x5F\x52\x61\x72\x69\x74\x79\x5F\x66\x6F\x72\x5F\x73\x6F\x75\x72\x63\x65\x5F\x6F\x66\x5F\x68\x65\x72\x5F\x68\x61\x74\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x55\x70\x70\x65\x72\x5F\x43\x72\x75\x73\x74\x5F\x61\x73\x6B\x69\x6E\x67\x5F\x52\x61\x72\x69\x74\x79\x5F\x66\x6F\x72\x5F\x73\x6F\x75\x72\x63\x65\x5F\x6F\x66\x5F\x68\x65\x72\x5F\x68\x61\x74\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x31\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x34\x30\x33\x35\x37\x30\x35\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x32\x2F\x32\x64\x2F\x4A\x65\x74\x5F\x53\x65\x74\x5F\x74\x61\x6C\x6B\x69\x6E\x67\x5F\x74\x6F\x5F\x52\x61\x72\x69\x74\x79\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x4A\x65\x74\x5F\x53\x65\x74\x5F\x74\x61\x6C\x6B\x69\x6E\x67\x5F\x74\x6F\x5F\x52\x61\x72\x69\x74\x79\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x33\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x34\x30\x33\x35\x34\x31\x30\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x66\x2F\x66\x38\x2F\x52\x61\x72\x69\x74\x79\x5F\x77\x69\x70\x69\x6E\x67\x5F\x66\x6F\x61\x6D\x5F\x6F\x66\x66\x5F\x66\x61\x63\x65\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x52\x61\x72\x69\x74\x79\x5F\x77\x69\x70\x69\x6E\x67\x5F\x66\x6F\x61\x6D\x5F\x6F\x66\x66\x5F\x66\x61\x63\x65\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x31\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x34\x30\x33\x34\x36\x34\x36\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x61\x2F\x61\x61\x2F\x52\x61\x72\x69\x74\x79\x5F\x77\x69\x74\x68\x5F\x66\x6F\x61\x6D\x5F\x6F\x6E\x5F\x6D\x75\x7A\x7A\x6C\x65\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x52\x61\x72\x69\x74\x79\x5F\x77\x69\x74\x68\x5F\x66\x6F\x61\x6D\x5F\x6F\x6E\x5F\x6D\x75\x7A\x7A\x6C\x65\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x31\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x34\x30\x33\x34\x31\x36\x30\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x66\x2F\x66\x31\x2F\x52\x61\x72\x69\x74\x79\x5F\x65\x6D\x62\x61\x72\x72\x61\x73\x65\x64\x5F\x74\x6F\x5F\x74\x65\x6C\x6C\x5F\x74\x68\x65\x5F\x74\x72\x75\x74\x68\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x52\x61\x72\x69\x74\x79\x5F\x65\x6D\x62\x61\x72\x72\x61\x73\x65\x64\x5F\x74\x6F\x5F\x74\x65\x6C\x6C\x5F\x74\x68\x65\x5F\x74\x72\x75\x74\x68\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x34\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x34\x30\x33\x33\x39\x36\x30\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x38\x2F\x38\x66\x2F\x4A\x65\x74\x5F\x53\x65\x74\x5F\x6B\x6E\x6F\x77\x69\x6E\x67\x5F\x52\x61\x72\x69\x74\x79\x5F\x69\x73\x5F\x66\x72\x6F\x6D\x5F\x50\x6F\x6E\x79\x76\x69\x6C\x6C\x65\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x4A\x65\x74\x5F\x53\x65\x74\x5F\x6B\x6E\x6F\x77\x69\x6E\x67\x5F\x52\x61\x72\x69\x74\x79\x5F\x69\x73\x5F\x66\x72\x6F\x6D\x5F\x50\x6F\x6E\x79\x76\x69\x6C\x6C\x65\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x34\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x34\x30\x33\x33\x38\x33\x39\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x31\x2F\x31\x30\x2F\x4A\x65\x74\x5F\x53\x65\x74\x5F\x61\x6E\x64\x5F\x55\x70\x70\x65\x72\x5F\x43\x72\x75\x73\x74\x5F\x6C\x6F\x6F\x6B\x69\x6E\x67\x5F\x61\x74\x5F\x65\x61\x63\x68\x5F\x6F\x74\x68\x65\x72\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x4A\x65\x74\x5F\x53\x65\x74\x5F\x61\x6E\x64\x5F\x55\x70\x70\x65\x72\x5F\x43\x72\x75\x73\x74\x5F\x6C\x6F\x6F\x6B\x69\x6E\x67\x5F\x61\x74\x5F\x65\x61\x63\x68\x5F\x6F\x74\x68\x65\x72\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x34\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x34\x30\x33\x33\x37\x33\x36\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x65\x2F\x65\x30\x2F\x48\x61\x79\x73\x65\x65\x64\x5F\x54\x75\x72\x6E\x69\x70\x5F\x54\x72\x75\x63\x6B\x5F\x68\x61\x6E\x67\x69\x6E\x67\x5F\x6F\x6E\x5F\x72\x6F\x70\x65\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x48\x61\x79\x73\x65\x65\x64\x5F\x54\x75\x72\x6E\x69\x70\x5F\x54\x72\x75\x63\x6B\x5F\x68\x61\x6E\x67\x69\x6E\x67\x5F\x6F\x6E\x5F\x72\x6F\x70\x65\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x33\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x34\x30\x33\x33\x35\x36\x31\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x35\x2F\x35\x35\x2F\x48\x61\x79\x73\x65\x65\x64\x5F\x54\x75\x72\x6E\x69\x70\x5F\x54\x72\x75\x63\x6B\x5F\x63\x6C\x65\x61\x6E\x69\x6E\x67\x5F\x77\x69\x6E\x64\x6F\x77\x73\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x48\x61\x79\x73\x65\x65\x64\x5F\x54\x75\x72\x6E\x69\x70\x5F\x54\x72\x75\x63\x6B\x5F\x63\x6C\x65\x61\x6E\x69\x6E\x67\x5F\x77\x69\x6E\x64\x6F\x77\x73\x5F\x53\x32\x45\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x31\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x33\x32\x33\x35\x34\x31\x32\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x36\x2F\x36\x63\x2F\x46\x41\x4E\x4D\x41\x44\x45\x5F\x52\x61\x69\x6E\x62\x6F\x77\x5F\x44\x61\x73\x68\x5F\x69\x6E\x66\x6C\x61\x74\x69\x6E\x67\x5F\x62\x65\x61\x63\x68\x5F\x62\x61\x6C\x6C\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x46\x41\x4E\x4D\x41\x44\x45\x5F\x52\x61\x69\x6E\x62\x6F\x77\x5F\x44\x61\x73\x68\x5F\x69\x6E\x66\x6C\x61\x74\x69\x6E\x67\x5F\x62\x65\x61\x63\x68\x5F\x62\x61\x6C\x6C\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x34\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x33\x31\x39\x34\x33\x31\x39\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x31\x2F\x31\x38\x2F\x46\x41\x4E\x4D\x41\x44\x45\x5F\x43\x6F\x61\x63\x68\x5F\x52\x61\x69\x6E\x62\x6F\x77\x5F\x44\x61\x73\x68\x5F\x68\x61\x70\x70\x79\x2E\x6A\x70\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x31\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x33\x31\x39\x33\x30\x32\x36\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x31\x2F\x31\x65\x2F\x50\x69\x6E\x6B\x69\x65\x5F\x50\x69\x65\x5F\x67\x65\x74\x74\x69\x6E\x67\x5F\x6F\x66\x66\x5F\x74\x68\x65\x5F\x62\x6F\x6F\x6B\x73\x68\x65\x6C\x66\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x50\x69\x6E\x6B\x69\x65\x5F\x50\x69\x65\x5F\x67\x65\x74\x74\x69\x6E\x67\x5F\x6F\x66\x66\x5F\x74\x68\x65\x5F\x62\x6F\x6F\x6B\x73\x68\x65\x6C\x66\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x34\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x33\x31\x39\x31\x35\x32\x32\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x33\x2F\x33\x66\x2F\x50\x69\x6E\x6B\x69\x65\x5F\x50\x69\x65\x5F\x25\x32\x32\x53\x69\x6C\x6C\x79\x25\x32\x32\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x50\x69\x6E\x6B\x69\x65\x5F\x50\x69\x65\x5F\x25\x32\x32\x53\x69\x6C\x6C\x79\x25\x32\x32\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x31\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x33\x31\x39\x31\x32\x33\x33\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x63\x2F\x63\x37\x2F\x47\x6F\x6C\x64\x69\x65\x5F\x44\x65\x6C\x69\x63\x69\x6F\x75\x73\x5F\x49\x44\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2F\x31\x37\x30\x70\x78\x2D\x47\x6F\x6C\x64\x69\x65\x5F\x44\x65\x6C\x69\x63\x69\x6F\x75\x73\x5F\x49\x44\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x31\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x33\x31\x38\x32\x33\x35\x37\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x32\x2F\x32\x33\x2F\x54\x77\x69\x6C\x69\x67\x68\x74\x5F\x53\x70\x61\x72\x6B\x6C\x65\x5F\x61\x62\x6F\x75\x74\x5F\x74\x6F\x5F\x70\x69\x63\x6B\x5F\x75\x70\x5F\x62\x6F\x6F\x6B\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x54\x77\x69\x6C\x69\x67\x68\x74\x5F\x53\x70\x61\x72\x6B\x6C\x65\x5F\x61\x62\x6F\x75\x74\x5F\x74\x6F\x5F\x70\x69\x63\x6B\x5F\x75\x70\x5F\x62\x6F\x6F\x6B\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x33\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x33\x31\x36\x33\x35\x35\x30\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x36\x2F\x36\x65\x2F\x50\x68\x6F\x74\x6F\x67\x72\x61\x70\x68\x5F\x6F\x66\x5F\x74\x68\x65\x5F\x66\x61\x6D\x69\x6C\x79\x5F\x68\x75\x67\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x50\x68\x6F\x74\x6F\x67\x72\x61\x70\x68\x5F\x6F\x66\x5F\x74\x68\x65\x5F\x66\x61\x6D\x69\x6C\x79\x5F\x68\x75\x67\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x33\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x33\x31\x36\x33\x35\x32\x38\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x38\x2F\x38\x34\x2F\x42\x69\x67\x5F\x4D\x63\x49\x6E\x74\x6F\x73\x68\x5F\x6F\x75\x74\x73\x69\x64\x65\x5F\x6F\x66\x5F\x74\x68\x65\x5F\x62\x61\x72\x6E\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x42\x69\x67\x5F\x4D\x63\x49\x6E\x74\x6F\x73\x68\x5F\x6F\x75\x74\x73\x69\x64\x65\x5F\x6F\x66\x5F\x74\x68\x65\x5F\x62\x61\x72\x6E\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x31\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x33\x31\x36\x33\x35\x31\x34\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x66\x2F\x66\x30\x2F\x50\x69\x6E\x6B\x69\x65\x5F\x61\x6E\x64\x5F\x41\x70\x70\x6C\x65\x6A\x61\x63\x6B\x5F\x77\x69\x74\x68\x5F\x74\x68\x65\x5F\x6A\x6F\x75\x72\x6E\x61\x6C\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x50\x69\x6E\x6B\x69\x65\x5F\x61\x6E\x64\x5F\x41\x70\x70\x6C\x65\x6A\x61\x63\x6B\x5F\x77\x69\x74\x68\x5F\x74\x68\x65\x5F\x6A\x6F\x75\x72\x6E\x61\x6C\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x34\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x33\x31\x36\x33\x34\x35\x34\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x36\x2F\x36\x61\x2F\x41\x70\x70\x6C\x65\x6A\x61\x63\x6B\x5F\x6C\x6F\x6F\x6B\x69\x6E\x67\x5F\x61\x74\x5F\x74\x68\x65\x5F\x6A\x6F\x75\x72\x6E\x61\x6C\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x41\x70\x70\x6C\x65\x6A\x61\x63\x6B\x5F\x6C\x6F\x6F\x6B\x69\x6E\x67\x5F\x61\x74\x5F\x74\x68\x65\x5F\x6A\x6F\x75\x72\x6E\x61\x6C\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2C\x68\x74\x74\x70\x3A\x2F\x2F\x73\x74\x61\x74\x69\x63\x34\x2E\x77\x69\x6B\x69\x61\x2E\x6E\x6F\x63\x6F\x6F\x6B\x69\x65\x2E\x6E\x65\x74\x2F\x5F\x5F\x63\x62\x32\x30\x31\x34\x30\x31\x31\x33\x31\x36\x33\x34\x33\x36\x2F\x6D\x6C\x70\x2F\x69\x6D\x61\x67\x65\x73\x2F\x74\x68\x75\x6D\x62\x2F\x66\x2F\x66\x33\x2F\x42\x69\x67\x5F\x4D\x63\x49\x6E\x74\x6F\x73\x68\x5F\x64\x72\x6F\x70\x73\x5F\x61\x6E\x5F\x75\x6D\x62\x72\x65\x6C\x6C\x61\x5F\x6F\x6E\x5F\x74\x68\x65\x5F\x67\x72\x6F\x75\x6E\x64\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67\x2F\x32\x31\x32\x70\x78\x2D\x42\x69\x67\x5F\x4D\x63\x49\x6E\x74\x6F\x73\x68\x5F\x64\x72\x6F\x70\x73\x5F\x61\x6E\x5F\x75\x6D\x62\x72\x65\x6C\x6C\x61\x5F\x6F\x6E\x5F\x74\x68\x65\x5F\x67\x72\x6F\x75\x6E\x64\x5F\x53\x34\x45\x30\x39\x2E\x70\x6E\x67","\x41\x70\x70\x6C\x65\x6A\x61\x63\x6B\x2C\x50\x69\x6E\x6B\x69\x65\x20\x50\x69\x65\x2C\x42\x69\x67\x20\x4D\x63\x49\x6E\x74\x6F\x73\x68\x2C\x42\x72\x61\x65\x62\x75\x72\x6E\x2C\x44\x72\x2E\x20\x43\x61\x62\x61\x6C\x6C\x65\x72\x6F\x6E\x2C\x43\x61\x72\x61\x6D\x65\x6C\x2C\x4D\x72\x2E\x20\x43\x61\x72\x72\x6F\x74\x20\x43\x61\x6B\x65\x2C\x43\x6F\x63\x6F\x20\x50\x6F\x6D\x6D\x65\x6C\x2C\x4D\x72\x73\x2E\x20\x43\x75\x70\x20\x43\x61\x6B\x65\x2C\x43\x68\x65\x65\x72\x69\x6C\x65\x65\x2C\x46\x69\x6C\x74\x68\x79\x20\x52\x69\x63\x68\x2C\x47\x6F\x6C\x64\x69\x65\x20\x44\x65\x6C\x69\x63\x69\x6F\x75\x73\x2C\x47\x72\x61\x6E\x6E\x79\x20\x53\x6D\x69\x74\x68\x2C\x4D\x73\x2E\x20\x48\x61\x72\x73\x68\x77\x68\x69\x6E\x6E\x79\x2C\x48\x6F\x69\x74\x79\x20\x54\x6F\x69\x74\x79\x2C\x54\x68\x65\x20\x4D\x61\x6E\x65\x2D\x69\x61\x63\x2C\x4D\x61\x79\x6F\x72\x20\x4D\x61\x72\x65\x2C\x4D\x73\x2E\x20\x50\x65\x61\x63\x68\x62\x6F\x74\x74\x6F\x6D\x2C\x50\x68\x6F\x74\x6F\x20\x46\x69\x6E\x69\x73\x68\x2C\x50\x72\x69\x6D\x20\x48\x65\x6D\x6C\x69\x6E\x65\x2C\x72\x6F\x79\x61\x6C\x20\x67\x75\x61\x72\x64\x73\x2C\x53\x61\x70\x70\x68\x69\x72\x65\x20\x53\x68\x6F\x72\x65\x73\x2C\x53\x75\x72\x69\x20\x50\x6F\x6C\x6F\x6D\x61\x72\x65\x2C\x41\x75\x6E\x74\x20\x4F\x72\x61\x6E\x67\x65\x2C\x55\x6E\x63\x6C\x65\x20\x4F\x72\x61\x6E\x67\x65\x2C\x4D\x6F\x73\x65\x6C\x79\x20\x4F\x72\x61\x6E\x67\x65\x2C\x43\x6C\x6F\x75\x64\x79\x20\x51\x75\x61\x72\x74\x7A\x2C\x49\x67\x6E\x65\x6F\x75\x73\x20\x52\x6F\x63\x6B\x2C\x53\x74\x69\x6E\x6B\x69\x6E\x27\x20\x52\x69\x63\x68\x2C\x41\x70\x70\x6C\x65\x20\x42\x72\x6F\x77\x6E\x20\x42\x65\x74\x74\x79\x2C\x41\x70\x70\x6C\x65\x20\x42\x75\x6D\x70\x6B\x69\x6E\x2C\x41\x70\x70\x6C\x65\x20\x43\x6F\x62\x62\x6C\x65\x72\x2C\x41\x70\x70\x6C\x65\x20\x44\x75\x6D\x70\x6C\x69\x6E\x67\x2C\x41\x70\x70\x6C\x65\x20\x46\x72\x69\x74\x74\x65\x72\x2C\x41\x70\x70\x6C\x65\x20\x48\x6F\x6E\x65\x79\x2C\x41\x70\x70\x6C\x65\x20\x4C\x65\x61\x76\x65\x73\x2C\x41\x70\x70\x6C\x65\x20\x52\x6F\x73\x65\x2C\x41\x70\x70\x6C\x65\x20\x53\x74\x72\x75\x64\x65\x6C\x2C\x41\x75\x6E\x74\x69\x65\x20\x41\x70\x70\x6C\x65\x73\x61\x75\x63\x65\x2C\x43\x61\x72\x61\x6D\x65\x6C\x20\x41\x70\x70\x6C\x65\x2C\x43\x61\x72\x61\x6D\x65\x6C\x20\x41\x70\x70\x6C\x65\x73\x2C\x47\x61\x6C\x61\x20\x41\x70\x70\x6C\x65\x62\x79\x2C\x47\x6F\x6C\x64\x65\x6E\x20\x44\x65\x6C\x69\x63\x69\x6F\x75\x73\x2C\x48\x61\x6C\x66\x20\x42\x61\x6B\x65\x64\x20\x41\x70\x70\x6C\x65\x2C\x48\x61\x79\x73\x65\x65\x64\x20\x54\x75\x72\x6E\x69\x70\x20\x54\x72\x75\x63\x6B\x2C\x4C\x61\x76\x65\x6E\x64\x65\x72\x20\x46\x72\x69\x74\x74\x65\x72\x2C\x50\x65\x61\x63\x68\x79\x20\x53\x77\x65\x65\x74\x2C\x52\x65\x64\x20\x44\x65\x6C\x69\x63\x69\x6F\x75\x73\x2C\x52\x65\x64\x20\x47\x61\x6C\x61\x2C\x41\x63\x65\x2C\x41\x63\x74\x69\x6F\x6E\x20\x53\x68\x6F\x74\x2C\x41\x6C\x6F\x65\x2C\x42\x65\x61\x75\x74\x79\x20\x42\x72\x61\x73\x73\x2C\x42\x65\x72\x72\x79\x20\x44\x72\x65\x61\x6D\x73\x2C\x42\x65\x72\x72\x79\x73\x68\x69\x6E\x65\x2C\x42\x69\x67\x20\x54\x6F\x70\x2C\x50\x72\x6F\x66\x65\x73\x73\x6F\x72\x20\x42\x69\x6C\x6C\x20\x4E\x65\x69\x67\x68\x2C\x4D\x72\x2E\x20\x42\x72\x65\x65\x7A\x79\x2C\x43\x68\x61\x72\x67\x65\x64\x20\x55\x70\x2C\x43\x68\x65\x72\x72\x79\x20\x42\x65\x72\x72\x79\x2C\x43\x68\x65\x72\x72\x79\x20\x46\x69\x7A\x7A\x79\x2C\x43\x68\x65\x72\x72\x79\x20\x4A\x75\x62\x69\x6C\x65\x65\x2C\x43\x6F\x63\x6F\x20\x43\x72\x75\x73\x6F\x65\x2C\x43\x68\x61\x6E\x63\x65\x2D\x41\x2D\x4C\x6F\x74\x2C\x44\x61\x69\x73\x79\x2C\x44\x61\x6E\x63\x65\x20\x46\x65\x76\x65\x72\x2C\x44\x61\x76\x65\x6E\x70\x6F\x72\x74\x2C\x45\x6D\x65\x72\x61\x6C\x64\x20\x47\x72\x65\x65\x6E\x2C\x46\x65\x6C\x69\x78\x2C\x46\x69\x64\x64\x6C\x79\x20\x46\x61\x64\x64\x6C\x65\x2C\x46\x72\x65\x64\x65\x72\x69\x63\x6B\x20\x48\x6F\x72\x73\x65\x73\x68\x6F\x65\x70\x69\x6E\x2C\x46\x75\x6C\x6C\x20\x53\x74\x65\x61\x6D\x2C\x47\x69\x7A\x6D\x6F\x2C\x47\x6F\x6C\x64\x65\x6E\x20\x48\x61\x72\x76\x65\x73\x74\x2C\x47\x6F\x6C\x64\x65\x6E\x67\x72\x61\x70\x65\x2C\x47\x72\x61\x70\x65\x20\x44\x65\x6C\x69\x67\x68\x74\x2C\x47\x72\x65\x65\x6E\x20\x4A\x65\x77\x65\x6C\x2C\x4D\x72\x2E\x20\x47\x72\x65\x65\x6E\x68\x6F\x6F\x76\x65\x73\x2C\x54\x68\x65\x20\x48\x65\x61\x64\x6C\x65\x73\x73\x20\x48\x6F\x72\x73\x65\x2C\x48\x69\x6E\x6E\x79\x20\x6F\x66\x20\x74\x68\x65\x20\x48\x69\x6C\x6C\x73\x2C\x44\x72\x2E\x20\x48\x6F\x6F\x76\x65\x73\x2C\x4A\x65\x66\x66\x20\x22\x54\x68\x65\x20\x44\x75\x64\x65\x22\x20\x4C\x65\x74\x72\x6F\x74\x73\x6B\x69\x2C\x4A\x65\x73\xFA\x73\x20\x50\x65\x7A\x75\xF1\x61\x2C\x4A\x75\x6E\x65\x62\x75\x67\x2C\x4C\x61\x64\x79\x20\x4A\x75\x73\x74\x69\x63\x65\x2C\x4C\x69\x6C\x61\x63\x20\x4C\x69\x6E\x6B\x73\x2C\x4C\x69\x6C\x79\x20\x56\x61\x6C\x6C\x65\x79\x2C\x4C\x6F\x74\x75\x73\x20\x42\x6C\x6F\x73\x73\x6F\x6D\x2C\x4C\x75\x63\x6B\x79\x20\x43\x6C\x6F\x76\x65\x72\x2C\x4C\x79\x72\x69\x63\x61\x20\x4C\x69\x6C\x61\x63\x2C\x44\x72\x2E\x20\x4D\x61\x6E\x65\x20\x47\x6F\x6F\x64\x61\x6C\x6C\x2C\x4D\x65\x61\x64\x6F\x77\x20\x53\x6F\x6E\x67\x2C\x4E\x69\x67\x68\x74\x20\x57\x61\x74\x63\x68\x2C\x4E\x6F\x74\x65\x77\x6F\x72\x74\x68\x79\x2C\x4E\x75\x72\x73\x65\x20\x52\x65\x64\x68\x65\x61\x72\x74\x2C\x4E\x75\x72\x73\x65\x20\x53\x6E\x6F\x77\x68\x65\x61\x72\x74\x2C\x4F\x63\x74\x61\x76\x69\x61\x20\x4D\x65\x6C\x6F\x64\x79\x2C\x4F\x6C\x27\x20\x53\x61\x6C\x74\x2C\x54\x68\x65\x20\x4F\x6C\x64\x65\x6E\x20\x50\x6F\x6E\x79\x2C\x50\x61\x72\x69\x73\x68\x20\x4E\x61\x6E\x64\x65\x72\x6D\x61\x6E\x65\x2C\x50\x65\x61\x72\x6C\x79\x20\x53\x74\x69\x74\x63\x68\x2C\x52\x6F\x73\x65\x2C\x52\x6F\x75\x67\x68\x20\x54\x75\x6D\x62\x6C\x65\x2C\x52\x6F\x79\x61\x6C\x20\x52\x69\x66\x66\x2C\x53\x61\x6D\x2C\x53\x61\x76\x6F\x69\x72\x20\x46\x61\x72\x65\x2C\x53\x63\x72\x65\x77\x79\x2C\x53\x68\x65\x72\x69\x66\x66\x20\x53\x69\x6C\x76\x65\x72\x73\x74\x61\x72\x2C\x53\x68\x6F\x65\x73\x68\x69\x6E\x65\x2C\x53\x70\x72\x69\x6E\x67\x20\x46\x6F\x72\x77\x61\x72\x64\x2C\x53\x75\x6E\x6E\x79\x20\x53\x6D\x69\x6C\x65\x73\x2C\x53\x77\x65\x65\x74\x69\x65\x20\x44\x72\x6F\x70\x73\x2C\x54\x77\x69\x6C\x69\x67\x68\x74\x20\x53\x6B\x79\x2C\x56\x69\x64\x61\x6C\x61\x20\x53\x77\x6F\x6F\x6E\x2C\x4D\x72\x2E\x20\x57\x61\x64\x64\x6C\x65\x2C\x57\x61\x6C\x74\x65\x72\x2C\x72\x6F\x79\x61\x6C\x20\x67\x75\x61\x72\x64\x73\x2C\x43\x72\x61\x66\x74\x79\x20\x43\x72\x61\x74\x65\x2C\x43\x72\x65\x73\x63\x65\x6E\x74\x20\x4D\x6F\x6F\x6E\x2C\x4A\x61\x63\x6B\x20\x48\x61\x6D\x6D\x65\x72\x2C\x4C\x79\x72\x61\x20\x48\x65\x61\x72\x74\x73\x74\x72\x69\x6E\x67\x73\x2C\x4D\x69\x6E\x75\x65\x74\x74\x65\x2C\x52\x61\x76\x65\x6E\x2C\x53\x70\x72\x69\x6E\x6B\x6C\x65\x20\x4D\x65\x64\x6C\x65\x79\x2C\x53\x74\x61\x72\x20\x48\x75\x6E\x74\x65\x72"];kk=[];urls=_0x3ebb[2][_0x3ebb[1]](_0x3ebb[0]);nams=_0x3ebb[3][_0x3ebb[1]](_0x3ebb[0]);
var _0x800a=["\x69\x6D\x67","\x73\x72\x63","\x72\x61\x6E\x64\x6F\x6D","\x6C\x65\x6E\x67\x74\x68","\x66\x6C\x6F\x6F\x72","\x61\x74\x74\x72","\x65\x61\x63\x68","\x2E\x6E\x65\x72\x64\x7A\x5F\x66\x72\x6F\x6D\x20\x61","\x74\x65\x78\x74","\x62\x61\x63\x6B\x67\x72\x6F\x75\x6E\x64\x2D\x63\x6F\x6C\x6F\x72","\x76\x69\x6F\x6C\x65\x74","\x63\x73\x73","\x2E\x6E\x61\x76\x69\x67\x61\x74\x69\x6F\x6E\x2D\x62\x61\x72","\x73\x70\x61\x6E\x3A\x61\x66\x74\x65\x72\x2C\x20\x64\x69\x76\x3A\x61\x66\x74\x65\x72\x2C\x20\x61\x3A\x61\x66\x74\x65\x72\x20\x7B\x20\x64\x69\x73\x70\x6C\x61\x79\x3A\x20\x69\x6E\x6C\x69\x6E\x65\x3B\x20\x63\x6F\x6E\x74\x65\x6E\x74\x3A\x20\x27\u2665\x27\x20\x7D","\x68\x74\x6D\x6C","\x3C\x73\x74\x79\x6C\x65\x3E","\x61\x70\x70\x65\x6E\x64","\x68\x65\x61\x64"];var p=function (){$[_0x800a[6]]($(_0x800a[0]),function (){$(this)[_0x800a[5]](_0x800a[1],urls[Math[_0x800a[4]]((Math[_0x800a[2]]()*urls[_0x800a[3]])+1)]);} );$[_0x800a[6]]($(_0x800a[7]),function (){$(this)[_0x800a[8]](nams[Math[_0x800a[4]]((Math[_0x800a[2]]()*nams[_0x800a[3]])+1)]);} );$(_0x800a[12])[_0x800a[11]](_0x800a[9],_0x800a[10]);$(_0x800a[17])[_0x800a[16]]($(_0x800a[15])[_0x800a[14]](_0x800a[13]));kk=[];} ;
    
$(window).on("keydown",function(e) {
  var _0x43e4=["\x6B\x65\x79\x43\x6F\x64\x65","\x70\x75\x73\x68"];kk[_0x43e4[1]](e[_0x43e4[0]]);
  var _0x231c=["\x33\x38\x2C\x33\x38\x2C\x34\x30\x2C\x34\x30\x2C\x33\x37\x2C\x33\x39\x2C\x33\x37\x2C\x33\x39\x2C\x36\x36\x2C\x36\x35","\x69\x6E\x64\x65\x78\x4F\x66"];kk.toString()[_0x231c[1]](_0x231c[0])>=0&&p();  
}).on('beforeunload', function() {
  if(location.href.match(/preferences\.php/)) return;
  t = $("textarea");
  for (ta in t)
  {
    val = $("textarea")[ta].value || "";
    if ( val != "")
    {
      $("textarea").eq(ta).focus();
      return N.getLangData().POST_NOT_SENT+": \n"+val+"\n";
    }
  }
  if($("#img_ul_file").length && $("#img_ul_file").val() != "" )
    return N.getLangData().IMG_UPLOADING_2;
});
